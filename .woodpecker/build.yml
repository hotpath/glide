when:
  - event: [ push, tag ]
    branch: [ main, develop ]
  - event: tag
  - event: manual

variables:
  - &image '${CI_REPO_OWNER}/${CI_REPO_NAME}'

steps:
  build:
    image: woodpeckerci/plugin-kaniko
    settings:
      registry: codeberg.org
      username:
        from_secret: codeberg_username
      password:
        from_secret: codeberg_token
      repo: *image
      dockerfile: Containerfile
      auto_tag: true
      tags:
        - latest
        - ${CI_COMMIT_SHA:0:8}
