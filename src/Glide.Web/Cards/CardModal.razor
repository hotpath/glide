@using Glide.Web.App
@using Glide.Web.Labels
@inject DateFormatService DateFormatService
<form class="modal-card-form"
      hx-put="/cards/@Card.Id"
      hx-target="#card-@Card.Id"
      hx-swap="outerHTML"
      hx-on::after-request="if(event.detail.successful && event.detail.elt.tagName === 'FORM') closeModal()">
    <div class="form-group">
        <label for="card-title">Title</label>
        <input type="text"
               id="card-title"
               name="title"
               value="@Card.Title"
               required
               class="form-input">
    </div>

    <div class="form-group">
        <label for="card-description">Description</label>
        <textarea id="card-description"
                  name="description"
                  rows="10"
                  class="form-textarea"
                  oninput="updateMarkdownPreview()">@Card.Description</textarea>
        <div class="help-text">Markdown supported</div>
    </div>

    <div class="form-group">
        <label>Preview</label>
        <div id="preview-content" class="markdown-preview"></div>
    </div>

    <div class="form-group">
        <label for="card-due-date">Due Date</label>
        @if (Card.DueDate.HasValue)
        {
            <div class="help-text" style="margin-bottom: 0.5rem;">
                Currently: @DateFormatService.FormatDate(Card.DueDate.Value)
            </div>
        }
        <input type="date"
               id="card-due-date"
               name="due_date"
               value="@(Card.DueDate?.ToString("yyyy-MM-dd"))"
               class="form-input">
        <div class="help-text">Browser will display date in your system locale</div>
    </div>

    <div class="form-group">
        <LabelPicker CardId="@Card.Id"
                     BoardId="@Card.BoardId"
                     CurrentLabels="@Card.Labels"
                     AvailableLabels="@AllBoardLabels"/>
    </div>

    <div class="modal-actions">
        <button type="submit" class="btn-primary">Save</button>
        <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
    </div>
</form>

@code
{
    [Parameter] public required CardView Card { get; init; }
    [Parameter] public required IEnumerable<LabelView> AllBoardLabels { get; init; }
}
