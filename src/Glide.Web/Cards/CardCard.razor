@using System
@using Glide.Web.Labels
<div class="card-card"
     id="card-@Card.Id"
     draggable="true"
     ondragstart="dragCard(event)"
     data-card-id="@Card.Id"
     data-column-id="@Card.ColumnId"
     onclick="openCardModal('@Card.Id')">
    <div class="card-content">
        <div class="card-title">@Card.Title</div>
        @if (!string.IsNullOrWhiteSpace(Card.Description))
        {
            <div class="card-description">@Card.Description</div>
        }
        @if (Card.DueDate.HasValue)
        {
            <div class="card-due-date @GetDueDateClass()">
                Due: @Card.DueDate.Value.ToString("yyyy-MM-dd")
            </div>
        }
        @if (Card.Labels.Any())
        {
            <div class="card-labels-compact">
                <LabelList Labels="@Card.Labels"/>
            </div>
        }
    </div>
    <div class="card-actions">
        <button class="card-delete"
                hx-delete="/cards/@Card.Id"
                hx-target="#card-@Card.Id"
                hx-swap="outerHTML swap:0s"
                hx-confirm="Delete this card?"
                onclick="event.stopPropagation()">
            Ã—
        </button>
    </div>
</div>

@code
{
    [Parameter] public required CardView Card { get; init; }

    private string GetDueDateClass()
    {
        if (!Card.DueDate.HasValue)
            return "";

        DateOnly today = DateOnly.FromDateTime(DateTime.Today);

        if (Card.DueDate.Value < today)
            return "due-date-overdue";

        if (Card.DueDate.Value == today)
            return "due-date-today";

        return "";
    }
}
